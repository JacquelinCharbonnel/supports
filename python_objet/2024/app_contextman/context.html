<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Context manager :: Supports</title>
    <link rel="canonical" href="https://jacquelincharbonnel.github.io/supports/python_objet/2024/app_contextman/context.html">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../../_/css/site.css">
<!-- reference des feuilles de styles supplémentaires -->
<link rel="stylesheet" href="../../../_/css/layout.css">
<link rel="stylesheet" href="../../../_/css/content.css">

  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://jacquelincharbonnel.github.io/supports">Supports</a>
  <!-- suppression du burger du bandeau
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
-->      
    </div>
<!-- suppression des boutons du bandeau
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>
-->
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="python_objet" data-version="2024">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Python objet</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../poo/poo.html">Concepts de la POO</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../objet/objet.html">Objet</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../operateurs/operateurs.html">Opérateurs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../classe/classe.html">Membres de classe</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../heritage/heritage.html">Héritage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../exception/exception.html">Exceptions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_iter/iter.html">Itérable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_files/files.html">Lecture/écriture de données</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="context.html">Context manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_serialisation/serialisation.html">Sérialisation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_callable/callable.html">Callables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Python objet</span>
    <span class="version">2024</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../C/2023/index.html">C</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../C/2023/index.html">2023</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../concurrence/2024/index.html">Concurrence</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../concurrence/2024/index.html">2024</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../linux_context/2025/index.html">Linux contexte</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../linux_context/2025/index.html">2025</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Python objet</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">2024</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../supports/index.html">Supports</a></div>
    </li>
    <li class="component">
      <div class="title"><a href="../../../xml/2023/index.html">XML</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../xml/2023/index.html">2023</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../supports/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Python objet</a></li>
    <li>Applications</li>
    <li><a href="context.html">Context manager</a></li>
  </ul>
</nav>
<!-- supression de "edit this page"
  <div class="edit-this-page"><a href="file:///home/jaclin/antora_components/python_objet/./modules/app_contextman/pages/context.adoc">Edit this Page</a></div>
-->
</div>
  <!-- ajout de la date de modification -->
     <div class="lastmodify"> dernière modification : 2024 </div>
  <!-- fin ajout -->
  <div class="content">
<aside class="toc sidebar" data-title="Plan" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Context manager</h1>
<div class="sect1">
<h2 id="_utiliser_un_context_manager"><a class="anchor" href="#_utiliser_un_context_manager"></a>1. Utiliser un context manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un <em>context manager</em> permet de grouper des instructions,
et d&#8217;exécuter automatiquement du code au préalable et a posteriori.</p>
</div>
<div class="listingblock">
<div class="title">exemple de context manager</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">with open('data', 'w') as mon_fichier: <i class="conum" data-value="1"></i><b>(1)</b>
  for i in range(-10,10):
      print(i, file=mon_fichier)
<i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ici, le fichier est ouvert</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>en sortie de bloc, le fichier est automatiquement fermé</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ce code est <em>à peu près</em> équivalent à :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">mon_fichier = open("data", "w")
for i in range(-10,10):
    print(i, file=mon_fichier)
mon_fichier.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Globalement, l&#8217;intérêt du context manager est de doter le traitement à réaliser d&#8217;un préambule et d&#8217;une conclusion, comme :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>une ouverture / fermeture (fichiers, sockets, etc.)</p>
</li>
<li>
<p>un verrouillage / déverrouillage (fichiers, transactions, code, etc.)</p>
</li>
<li>
<p>une allocation / libération (mémoire, session, etc.)</p>
</li>
<li>
<p>une connexion / déconnexion (réseau, sgbd, etc.)</p>
</li>
<li>
<p>un démarrage / arrêt (service, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>et d&#8217;assurer que la conclusion sera réalisée, quels que soient les évènements qui peuvent advenir.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ecrire_un_context_manager"><a class="anchor" href="#_ecrire_un_context_manager"></a>2. Ecrire un context manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un contexte manager <code>Cm</code> est une classe possédant 2 méthodes particulières :
<code>__enter__()</code> et <code>__exit()__</code>,
correspondant au préambule et à la conclusion,
et qui, de ce fait, s&#8217;utilise comme :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">with Cm() : <i class="conum" data-value="1"></i><b>(1)</b>
  <i class="conum" data-value="2"></i><b>(2)</b>
  ...
  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>création d&#8217;un context_manager anonyme</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>exécution de <code>Cm()</code>.__enter__()`</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>exécution de <code>Cm()</code>.__exit__(&#8230;&#8203;)`</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ou</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">with Cm() as mon_context_manager: <i class="conum" data-value="1"></i><b>(1)</b>
  <i class="conum" data-value="2"></i><b>(2)</b>
  ...
  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>création d&#8217;une instance <code>mon_context_manager</code> de type context_manager</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>exécution de <code>mon_context_manager.__enter__()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>exécution de <code>mon_context_manager.__exit__(&#8230;&#8203;)</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_méthodes_enter_et_exit"><a class="anchor" href="#_méthodes_enter_et_exit"></a>2.1. Méthodes <code>__enter__()</code> et <code>__exit__()</code></h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>__enter__(self)</code></dt>
<dd>
<p>Cette méthode implémente le préambule,
et doit renvoyer ce que l&#8217;on veut récupérer dans la variable spécifiée après <code>as</code>.</p>
</dd>
<dt class="hdlist1"><code>__exit__(self,type,value,traceback)</code></dt>
<dd>
<p>Cette méthode implémente l&#8217;épilogue.
Elle est définie avec 4 paramètres.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_arguments"><a class="anchor" href="#_arguments"></a>2.2. Arguments</h3>
<div class="paragraph">
<p>Des arguments peuvent être spécifiés à la création du context manager :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">with Cm(arg1,arg2) as mon_context_manager:
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ils sont alors récupérables via les paramètres du constructeur.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exit"><a class="anchor" href="#_exit"></a>2.3. <code>__exit__()</code></h3>
<div class="paragraph">
<p>Cette méthode est déclarée comme <code>__exit__(self,type,value,traceback)</code>.</p>
</div>
<div class="paragraph">
<p>Si l&#8217;on entre dans <code>__exit__()</code> en situation normale
(c&#8217;est-à-dire parce que l&#8217;exécution du bloc se termine normalement),
alors les paramètres n&#8217;ont pas d&#8217;intérêt (ils valent <code>None</code>).</p>
</div>
<div class="paragraph">
<p>Si l&#8217;on entre dans <code>__exit__()</code> parce qu&#8217;une exception a été lancée depuis le bloc
(donc son exécution s&#8217;est terminée prématurément),
alors on récupère dans les paramètres le type de l&#8217;exception (<code>type</code>), sa valeur (<code>value</code>) et un objet permettant d&#8217;accéder à la pile des appels en cours (<code>traceback</code>).</p>
</div>
<div class="paragraph">
<p>En sortant de <code>__exit__()</code>, si celle-ci renvoie <code>True</code>, alors l&#8217;exception est attrapée et supposée traitée
(et par conséquent l&#8217;exécution du programme se poursuit normalement, après le context manager).
Sinon (cas où <code>__exit__()</code> ne renvoie pas <code>True</code>) l&#8217;exception poursuit sa remontée.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p class="center">
  <span style="font-size: 0.9em;">
    <a href="https://jacquelincharbonnel.github.io/">Jacquelin Charbonnel</a>
    <!-- &nbsp; &mdash; &nbsp; -->
    &nbsp;
    &copy;Creative Commons BY-NC-SA 4.0
  </span>
  </p>
</footer>

<script>
var myDate = new Date(document.lastModified);
myNewDate = new Intl.DateTimeFormat(
            undefined,
            {year: "numeric", month: "long", day: "numeric", hour: "2-digit", minute: "2-digit"}
        )
        .format(myDate).replace(/\./g, '-');
document.getElementById("lastmodify").innerHTML = myNewDate ;
</script>

<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
