<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Exceptions :: Supports</title>
    <link rel="canonical" href="https://jacquelincharbonnel.github.io/supports/python_objet/2024/exception/exception.html">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../../_/css/site.css">
<!-- reference des feuilles de styles suppl√©mentaires -->
<link rel="stylesheet" href="../../../_/css/layout.css">
<link rel="stylesheet" href="../../../_/css/content.css">

  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://jacquelincharbonnel.github.io/supports">Supports</a>
  <!-- suppression du burger du bandeau
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
-->      
    </div>
<!-- suppression des boutons du bandeau
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>
-->
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="python_objet" data-version="2024">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Python objet</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../poo/poo.html">Concepts de la POO</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../objet/objet.html">Objet</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../operateurs/operateurs.html">Op√©rateurs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../classe/classe.html">Membres de classe</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../heritage/heritage.html">H√©ritage</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="exception.html">Exceptions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_iter/iter.html">It√©rable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_files/files.html">Lecture/√©criture de donn√©es</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_contextman/context.html">Context manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_serialisation/serialisation.html">S√©rialisation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../app_callable/callable.html">Callables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Python objet</span>
    <span class="version">2024</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../C/2023/index.html">C</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../C/2023/index.html">2023</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../concurrence/2024/index.html">Concurrence</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../concurrence/2024/index.html">2024</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../linux_context/2025/index.html">Linux contexte</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../linux_context/2025/index.html">2025</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Python objet</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">2024</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Python objet</a></li>
    <li><a href="exception.html">Exceptions</a></li>
  </ul>
</nav>
<!-- supression de "edit this page"
  <div class="edit-this-page"><a href="file:///home/jaclin/antora_components/python_objet/./modules/exception/pages/exception.adoc">Edit this Page</a></div>
-->
</div>
  <!-- ajout de la date de modification -->
  <div class="lastmodify"> modifi√© le <span id="lastmodify"/> </div>
  <!-- fin ajout -->
  <div class="content">
<aside class="toc sidebar" data-title="Plan" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Exceptions</h1>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock right">
<div class="content">
<img src="_images/pommes.jpg" alt="pommes" width="150">
</div>
</div>
<div class="paragraph">
<p>Une exception est un m√©canisme destin√© √† signaler que quelque chose d‚Äôanormal se produit.
Le court normal d&#8217;ex√©cution du programme est alors chamboul√©.</p>
</div>
<div class="paragraph">
<p>Le concept d&#8217;exception n&#8217;est pas li√© √† la programmation orient√©e objet :
les langages ori√©nt√©s objet ne sont pas les seuls √† pouvoir
disposer de m√©canisme de gestion d&#8217;exception.
Mais les exceptions facilitent la conception de briques logicielles r√©utilisables.
C&#8217;est pourquoi on les voit appara√Ætre dans ce contexte.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Les exemples et exercices de ce chapitre sont √† ex√©cuter dans un terminal,
car les environnement de d√©veloppement (comme <em>spyder</em> &amp; co)
attrapent une partie des exceptions pour leur propre compte.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">exemple</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">#!/bin/env python3
# fichier exceptions1.py

def myfunction():
    x = 1/0             # 4

def mafonction():
    myfunction()        # 7

def main():
    mafonction()        # 10

if __name__ == "__main__":
    main()              # 13</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Traceback (most recent call last): <i class="conum" data-value="1"></i><b>(1)</b>
  File "exceptions1.py", line 13, in &lt;module&gt;
    main()
  File "exceptions1.py", line 10, in main
    mafonction()
  File "exceptions1.py", line 7, in mafonction
    myfunction()
  File "exceptions1.py", line 4, in myfunction
    x = 1/0
ZeroDivisionError: division by zero <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>pile des appels de fonction en cours</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>cette ligne indique le type de l&#8217;exception et un message explicatif</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A chaque type d&#8217;exception (dans l&#8217;exemple <code>ZeroDivisionError</code>) correspond une classe.
Python propose une hi√©archie de classes d' <a href="https://docs.python.org/fr/3/library/exceptions.html#exception-hierarchy">exceptions pr√©d√©finies</a>.
Le d√©veloppeur peut piocher dans ces classes pour identifier et g√©rer ses propres exceptions.
Il peut aussi vouloir les g√©rer plus finement,
et pour cela,
il peut cr√©er de nouvelles classes plus adapt√©es √† ses besoins,
par h√©ritage de classes prises dans cette hi√©rarchie.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gestion_des_exceptions"><a class="anchor" href="#_gestion_des_exceptions"></a>2. Gestion des exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pourquoi a-t-on besoin d&#8217;un m√©canisme sp√©cial
(une structure de contr√¥le particuli√®re, comparable √† <code>if</code>&#8230;&#8203;<code>else</code> ou <code>for</code>&#8230;&#8203;<code>in</code>&#8230;&#8203;)
pour g√©rer les exceptions ?
Pour le comprendre, il faut voir qu&#8217;un logiciel est un empilement de couches,
r√©alis√©es ind√©pendamment les unes des autres.</p>
</div>
<div class="paragraph">
<p>En POO, on d√©finit des classes de bas niveau (c&#8217;est-a-dire qui collent aux structures de donn√©es) :
par exemple des listes, des files, des chaines de caract√®res particuli√®res, etc.
Puis, avec ces classes, on construit des classes de plus haut niveau (c&#8217;est-√†-dire qui collent au <em>m√©tier</em> : math, physique, gestion, biologie etc.).
Et, au final, on √©labore un programme construit √† partir de ces classes de haut niveau.</p>
</div>
<div class="paragraph">
<p>En programmation <em>classique</em>, c&#8217;est la m√™me chose : les fonctions de haut niveau d&#8217;abstraction s&#8217;appuient sur des fonctions de plus bas niveau, qii elles-m√™mes font la m√™me chose.</p>
</div>
<div class="paragraph">
<p>Lorsqu&#8217;une erreur survient au plus profond du code, dans les couches basses,
comment la traiter ?
L‚Äôutilisateur d‚Äôun composant logiciel de haut niveau,
qui ne peut pas intervenir lors de l‚Äôapparition d‚Äôune erreur √† l‚Äôint√©rieur du composant qu‚Äôil utilise,
peut vouloir la traiter √† sa fa√ßon.
Et sym√©triquement, le concepteur du composant de bas niveau,
qui lui peut d√©tecter l‚Äôerreur d√®s qu‚Äôelle apparait,
n‚Äôa probablement pas les √©l√©ments pour la g√©rer judicieusement.</p>
</div>
<h3 id="_exemple_bob_alice_yann" class="discrete">Exemple Bob-Alice-Yann</h3>
<div class="paragraph">
<p>Par exemple, soit une application <code>appli.py</code> utilisant un module <code>moduleAlice</code>,
utilisant √† son tour un module <code>moduleYann</code> :</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">fichier appli.py √©crit en 2024 par Bob</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleAlice import acquerirDonnees

def traiterDonnees(jeuDonnees):
  ...
  acquerirDonnees(jeuDonnees)
  ...

if __name__=="__main__":
  for data in [data1, data2, data3, data4, data5]:
    traiterDonnees(data)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleAlice.py √©crit en 2022 par Alice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleYann import lire

def acquerirDonnees(filename):
  ...
  lire(filename)
  ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleYann.py √©crit en 2021 par Yann</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">def lire(file):
  ...
  f = open(file, "r")
  ...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Si Bob, en 2024, fournit un jeu de donn√©es inexistant √† la fonction <code>acquerirDonn√©es</code>,
c&#8217;est la fonction <code>lire</code> de Yann qui va s&#8217;en rendre compte.
Bob aimerait pourtant bien pouvoir intervenir quand le jeu de donn√©es qu&#8217;il fournit
pose probl√®me, mais comment faire sans modifier le module de Yann ?</p>
</div>
<div class="paragraph">
<p>La solution consistant √† stopper net l&#8217;ex√©cution du programme est trop radicale,
car elle ne permet pas de rem√©dier au probl√®me,
ni m√™me d&#8217;en comprendre la cause (√† ce niveau de profondeur, on n&#8217;a pas le recul suffisant pour comprendre comment et pourquoi on en est arriv√© l√†).
En caricaturant, on peut dire que :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ce sont les couches basses qui d√©tectent les probl√®mes, mais elles ne comprennent pas le processus qui les provoque,</p>
</li>
<li>
<p>les couches hautes poss√®dent la vue d&#8217;ensemble permettant de comprendre comment et pourquoi les probl√®mes apparaissent, mais ne les d√©tectent pas.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le m√©canisme d&#8217;exceptions est fait pour g√©rer cela.
Il permet :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>aux couches basses d&#8217;envoyer un signal vers les couches hautes pour  signaler une anomalie (<em>lancer</em> une exception),</p>
</li>
<li>
<p>quelque part dans les couches hautes, √† l&#8217;endroit o√π l&#8217;anomalie peut √™tre trait√©e judicieusement, de prendre la main pour y rem√©dier (<em>attraper</em> l&#8217;exception et la traiter).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Il offre un moyen de d√©router le flux d‚Äôex√©cution
du point de d√©tection de l‚Äôerreur au point ad√©quat pour la traiter
(saut dans le d√©roulement du programme accompagn√© d‚Äôun transfert d‚Äôinformation).</p>
</div>
<div class="paragraph">
<p>Le champ d‚Äôaction du m√©canisme d&#8217;exceptions est plus large que la gestion des erreurs,
et s‚Äôapplique √† toute situation exceptionnelle
(comme la fin d‚Äôune it√©ration, la fin de lecture d‚Äôun fichier, etc.).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Comportement par d√©faut de Python</dt>
<dd>
<p>Par d√©faut, lorsqu&#8217;une erreur (arithm√©tique, p√©riph√©rique, math√©matique, etc.) est d√©tect√©e, une exception est automatiquement lanc√©e.
Rien n&#8217;attrape cette exception, et le programme s&#8217;arr√™te brutalement,
en sortant un message (indiquant le type de l&#8217;exception et le contenu de la pile des appels de fonctions).
C&#8217;est le comportement standard auquel conduit toute exception non attrap√©e.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lancer_une_exception"><a class="anchor" href="#_lancer_une_exception"></a>3. Lancer une exception</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On lance une exception avec l&#8217;instruction <code>raise</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On peut lancer une exception pour signaler autre chose qu&#8217;une erreur.
Par exemple, Python lance des <code>StopIteration</code> lorsqu&#8217;une it√©ration arrive normalement √† son terme.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Exemple, soit la classe <code>Fraction</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">class Fraction:
  def __init__(self,n,d):
    self.num = n
    self.den = d

  def reduire(self):
    pgcd = gcd(self.num,self.den)
    self.num //= pgcd
    self.den //= pgcd
    return self

  def __float__(self,r):
    return self.num / self.den
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bien que cr√©er une fraction avec un d√©nominateur nul ne pose pas de probl√®me imm√©diat,
t√¥t ou tard une erreur arithm√©tique fatale va appara√Ætre
(lors du calcul du PGCD, du quotient, etc.).
On peut donc anticiper en lan√ßant une exception d√®s la cr√©ation d&#8217;une fraction avec un d√©nominateur nul :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">class Fraction:
  def __init__(self,n,d):
    if d==0:
        raise ValueError(f"probl√®me pour cr√©er Fraction({n},{d}) !") <i class="conum" data-value="1"></i><b>(1)</b>
    self.num = n
    self.den = d
  ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ici, un objet de type <code>ValueError</code> est cr√©√©, puis il est lanc√© vers les couches hautes</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Autre strat√©gie possible :
autoriser la cr√©ation d&#8217;une fraction √† d√©nominateur nul,
et lancer une exception au dernier moment, juste avant une division par 0 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">class Fraction:
  def __init__(self,n,d):
    self.num = n
    self.den = d

  def reduire(self):
    if self.den==0:
      raise ArithmeticError(f"probl√®me pour r√©duire la Fraction({self.num},{self.den}) !")
    pgcd = gcd(self.num,self.den)
    self.num //= pgcd
    self.den //= pgcd
    return self

  def __float__(self,r):
    if self.den==0:
      raise ZeroDivisionError(f"probl√®me pour obtenir le quotien de la Fraction({self.num},{self.den}) !")
    return self.num / self.den
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Les instances de type <code>ArithmeticError</code> et <code>ZeroDivisionError</code> vont remonter
la pile des appels de fonctions,
et pourront √™tre attrap√©es par n&#8217;importe quelle fonction en cours d&#8217;ex√©cution.
Toute instance non attrap√©e donnera lieu au comportement par d√©faut,
√† savoir interruption brutale du programme et √©criture
du message d&#8217;erreur standard.</p>
</div>
<div class="sect2">
<h3 id="_exception_personnalis√©e"><a class="anchor" href="#_exception_personnalis√©e"></a>Exception personnalis√©e</h3>
<div class="paragraph">
<p>Si aucune exception pr√©d√©finie ne correspond √† ce que l&#8217;on veut signaler,
ou bien si l&#8217;on veut remonter de l&#8217;information suppl√©mentaire,
alors il est possible de se cr√©er un type particulier d&#8217;exception.
Pour cela, il suffit de d√©river une nouvelle classe de l&#8217;une des classes exceptions pr√©d√©finies.
Par exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">class MonErreur(RuntimeError):
  def __init__(self,msg,q):
    super().__init__(msg)
    self.num,self.den = q.num,q.den
    self.strict_mode = q.strict_mode
    self.auto_reduire = q.auto_reduire</code></pre>
</div>
</div>
<div class="paragraph">
<p>que l&#8217;on peut utiliser ensuite comme :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">class Fraction:
  strict_mode = True
  auto_reduire = True

  @classmethod
  def strict_disable(cls):
    cls.strict_mode = False

  def __init__(self,n,d):
    self.num = n
    self.den = d
    if Fraction.strict_mode:
      if d==0:
        raise MonErreur("probl√®me √† la cr√©ation",self)
    if Fraction.auto_reduire:
        self.reduire()

  def reduire(self):
    if self.den==0:
      raise MonErreur("probl√®me √† la simplification",self)

    pgcd = gcd(self.num,self.den)
    self.num //= pgcd
    self.den //= pgcd
    return self</code></pre>
</div>
</div>
<div class="paragraph">
<p>Avec cela, l&#8217;instruction :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">q = Fraction(1,0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>donne</p>
</div>
<div class="listingblock">
<div class="content">
<pre>raise MonErreur("probl√®me √† la cr√©ation",self)
__main__.MonErreur: probl√®me √† la cr√©ation</pre>
</div>
</div>
<div class="paragraph">
<p>alors que :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">Fraction.strict_disable()
q = Fraction(1,0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>donne :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>raise MonErreur("probl√®me √† la simplification",self)
__main__.MonErreur: probl√®me √† la simplification</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_attraper_une_exception"><a class="anchor" href="#_attraper_une_exception"></a>4. Attraper une exception</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Attraper une exception va permettre, avant que le programme
ne s&#8217;arr√™te brutalement, de prendre la main pour expliquer clairement √† l&#8217;utilisateur
 ce qui s&#8217;est pass√©, ou mieux, pour tenter de corriger le probl√®me
 (ou moins bien, le mettre sous le tapis üòâ).</p>
</div>
<div class="paragraph">
<p>Par exemple, le code ci-dessous attrape les exceptions de type <code>ArithmeticError</code> et <code>ValueError</code>
lanc√©es soit par le constructeur de <code>Fraction</code> (instruction <code>f=Fraction(a,b)</code>),
soit par la m√©thode <code>reduire</code> (instruction <code>f.reduire()</code>) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">a = int(input("entrer un premier entier :"))
b = int(input("entrer un second entier :"))
try:                              <i class="conum" data-value="1"></i><b>(1)</b>
  f = Fraction(a,b)
  f.reduire()
except ArithmeticError:    <i class="conum" data-value="2"></i><b>(2)</b>
  print("probl√®me pour calculer le PGCD")
  exit(1)
except ValueError:    <i class="conum" data-value="3"></i><b>(3)</b>
  print("une fraction √† d√©nominateur nul a √©t√© d√©tect√©e")
  exit(1)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>try</code> d√©finit un bloc r√©ceptif aux exceptions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>si une exception de type <code>ArithmeticError</code> est lanc√©e dans le bloc <code>try</code> pr√©c√©dent,
alors elle sera attrap√©e, et l&#8217;ex√©cution sera d√©rout√©e directement ici ;
s&#8217;il s&#8217;agit d&#8217;un autre type d&#8217;exception, ou si aucune exception n&#8217;est lanc√©e,
alors ce bloc <code>except</code> n&#8217;est pas ex√©cut√©</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>m√™me chose pour une <code>ValueError</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On peut r√©cup√©rer l&#8217;objet lanc√© par <code>raise</code>.
C&#8217;est int√©ressant, car cet objet peut fournir des infos utiles sur ce qu&#8217;il s&#8217;est pass√© :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">class Fraction:
  strict_mode = True
  auto_reduire = True

  @classmethod
  def strict_enable(cls):
    cls.strict_mode = True

  @classmethod
  def strict_disable(cls):
    cls.strict_mode = False

  @classmethod
  def reduire_enable(cls):
    cls.auto_reduire = True

  @classmethod
  def reduire_disable(cls):
    cls.auto_reduire = False

  def __init__(self,n,d):
    self.num = n
    self.den = d
    if Fraction.strict_mode:
      if d==0:
        raise ValueError(f"probl√®me pour cr√©er Fraction({n},{d}) !")
    if Fraction.auto_reduire:
        self.reduire()

  def reduire(self):
    if self.den==0:
      raise ArithmeticError(f"probl√®me pour r√©duire la Fraction({self.num},{self.den}) !")

    pgcd = gcd(self.num,self.den)
    self.num //= pgcd
    self.den //= pgcd
    return self</code></pre>
</div>
</div>
<div class="paragraph">
<p>ce qui permet d&#8217;√©crire :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">try:
  f = Fraction(1,0)
  f.reduire()
except ArithmeticError as e :
  print(e)                     <i class="conum" data-value="1"></i><b>(1)</b>
  exit(1)
except ValueError as e:    <i class="conum" data-value="2"></i><b>(2)</b>
  print(e)
  exit(1)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>sort <code>"probl√®me pour r√©duire la Fraction(1,0) !"</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>sort <code>"probl√®me pour cr√©er Fraction(1,0)"</code></td>
</tr>
</table>
</div>
<h3 id="_exemple_bob_alice_yann_2" class="discrete">Exemple Bob-Alice-Yann</h3>
<div class="paragraph">
<p>Dans exemple Bob-Alice-Yann, soit Alice poss√®de tous les √©l√©ments pour tenter de corriger le probl√®me,
et, dans ce cas, elle le g√®re (et Bob n&#8217;a rien √† faire) :</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">fichier appli.py - Bob</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleAlice import acquerirDonnees
def traiterDonnees(jeuDonnees):
  ...
  acquerirDonnees(jeuDonnees)
  ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleAlice.py - Alice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleYann import lire
def acquerirDonnees(filename):
  ...
  try:
    lire(filename)
  except FileNotFoundError:
    ...
  ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleYann.py - Yann</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">def lire(file):
  ...
  f = open(file, "r")
  ...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ou sinon, Bob d√©tient peut-√™tre la cl√© du probl√®me, et dans ce cas,
c&#8217;est lui qui g√®re :</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">fichier appli.py - Bob</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleAlice import acquerirDonnees
def traiterDonnees(jeuDonnees):
  ...
  try:
    acquerirDonnees(jeuDonnees)
  except FileNotFoundError:
    ...
  ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleAlice.py - Alice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleYann import lire
def acquerirDonnees(filename):
  ...
  lire(filename)
  ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleYann.py - Yann</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">def lire(file):
  ...
  f = open(file, "r")
  ...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Le traitement de l&#8217;exception peut aussi √™tre incr√©mental,
c&#8217;est-√†-dire g√©r√© par Alice et Bob, chacun √† leur niveau :</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">fichier appli.py - Bob</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleAlice import acquerirDonnees
def traiterDonnees(jeuDonnees):
  ...
  try:
    acquerirDonnees(jeuDonnees)
  except FileNotFoundError:
    ...
  ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleAlice.py - Alice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from moduleYann import lire
def acquerirDonnees(filename):
  ...
  try:
    lire(filename)
  except FileNotFoundError:
    ... # traitement partiel
    raise # relance la m√™me exception vers les couches hautes
  ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fichier moduleYann.py - Yann</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">def lire(file):
  ...
  f = open(file, "r")
  ...</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Ici, Alice corrige partiellement le probl√®me, puis relance la m√™me exception,
qui va donc continuer sa remont√©e vers Bob, qui l&#8217;attrapera √† son tour
pour terminer son traitement.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pile_des_appels_de_fonctions"><a class="anchor" href="#_pile_des_appels_de_fonctions"></a>5. Pile des appels de fonctions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le module <code>traceback</code> permet de r√©cup√©rer des informations relatives √† l&#8217;√©tat de la pile des appels de fonctions en cours, via notamment sa fonction <code>print_exc()</code> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>traceback.print_exc()</code> affiche l&#8217;√©tat de la pile comme le ferait le comportement standard d&#8217;une exception non attrap√©e,</p>
</li>
<li>
<p><code>traceback.print_exc(limit=n)</code>, n&gt;0, affiche les n premier √©l√©ments de la pile des appels,</p>
</li>
<li>
<p><code>traceback.print_exc(limit=-n)</code>, n&gt;0, affiche les n derniers √©l√©ments de la pile des appels.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changer_dexception_en_cours_de_route"><a class="anchor" href="#_changer_dexception_en_cours_de_route"></a>6. Changer d&#8217;exception en cours de route</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les donn√©es et m√™me le type d&#8217;une exception peuvent √™tre modifi√©s au cours de la remont√©e :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">def f():
  raise ConnectionError

def g():
  try:
    f()
  except ConnectionError as e:
    raise RuntimeError('Failed to open database') from e</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ici, l&#8217;exception <code>ConnectionError</code> est attrap√©e, puis transform√©e en <code>RuntimeError</code>, et relanc√©e.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p class="center">
  <span style="font-size: 0.9em;">
    <a href="https://jacquelincharbonnel.github.io/">Jacquelin Charbonnel</a>
    <!-- &nbsp; &mdash; &nbsp; -->
    &nbsp; &nbsp;
    &copy;Creative Commons BY-NC-SA 4.0
  </span>
  </p>
</footer>

<script>
var myDate = new Date(document.lastModified);
myNewDate = new Intl.DateTimeFormat(
            undefined,
            {year: "numeric", month: "long", day: "numeric", hour: "2-digit", minute: "2-digit"}
        )
        .format(myDate).replace(/\./g, '-');
document.getElementById("lastmodify").innerHTML = myNewDate ;
</script>

<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
